import java.util.StringTokenizer;

public class TestInfix2PostfixCalculator {
	
	public static void main(String[] args) {
		
		printResults("(10 + 3 * 4 / 6)");
		printResults("12*3 - 4 + (18/6)");
		printResults("35 - 42* 17 /2 + 10");
		printResults("3 * (4 + 5)");
		printResults("3 * ( 17 - (5+2))/(2+3)");
	}
	
	private static String convertPostFix(String infix) {
		infix = infix.replaceAll("\\s", "");
		
		StackReferenceBased opStack = new StackReferenceBased();
		char curr;
		String output = "";
		int i = 0;
		
		while (i != infix.length()) {
			curr = infix.charAt(i);
			if (precedence(curr) == -1) {
				int j = i + 1;
				String operand = infix.substring(i, j);
				while (precedence(infix.charAt(j)) == -1) {
					j++;
					operand = infix.substring(i, j);
				}
				i = j;
				output += " " + operand;
 			} else {
				if (curr == ')') {
					Object o;
					while ((o = opStack.peek()).toString().charAt(0) == '(') {
						char c = o.toString().charAt(0);
						if (precedence(c) != 1)
							output += " " + c;
					}
				} else {
					while (!opStack.isEmpty() && curr != '(' && precedence(opStack.peek().toString().charAt(0)) >= precedence(curr)) {
						char c = opStack.pop().toString().charAt(0);
						if (precedence(c) != 1)
							output += " " + c;
					}
					opStack.push(curr);
				}
				i++;
			}
		}
		while (!opStack.isEmpty()) {
			char c = opStack.pop().toString().charAt(0);
			if (precedence(c) != 1)
				output += " " + c;
		}
		return output.trim();
	}
	
	private static int getPostFix(String postfix) {
		StringTokenizer tokens = new StringTokenizer(postfix);
		StackReferenceBased stack = new StackReferenceBased();
		while (tokens.hasMoreTokens()) {
			String curr = tokens.nextToken();
			if (precedence(curr.charAt(0)) != -1)
				stack.push(doMath(stack.pop(), stack.pop(), curr.charAt(0)));
			else
				stack.push(curr);
		}
		return Integer.valueOf(stack.pop().toString());
	}
	
	private static int doMath(Object a, Object b, char op) {
		int x = Integer.valueOf(b.toString());
		int y = Integer.valueOf(a.toString());
		switch (op) {
			case '+':
				return x + y;
			case '-':
				return x - y;
			case '*':
				return x * y;
			case '/':
				return x / y;
		}
		return -1;
	}
	
	private static int precedence(char op) {
		if (op == '(' || op == ')')
			return 1;
		if (op == '+' || op == '-')
			return 2;
		if (op == '*' || op == '/')
			return 3;
		return -1;
	}
	
	private static void printResults(String infix) {
		System.out.println("infix: " + infix);
		System.out.println("postfix: " + convertPostFix(infix));
		System.out.println("result: " + getPostFix(convertPostFix(infix)) + "\n");
	}
}
